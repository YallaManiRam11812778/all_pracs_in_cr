import pandas as pd
from pandas import Timestamp
import datetime
a = [{'name': 'e7cb7fd880', 'owner': 'ezyadmin@caratred.com', 'creation': Timestamp('2025-02-26 21:52:13.958044'), 'modified': Timestamp('2025-03-02 12:37:17.838581'), 'modified_by': 'Administrator', 'docstatus': 0, 'idx': 1, 'item_value': 0.0, 'item_value_after_gst': 10.0, 'item_name': 'Tourism Tax', 'trx_code': '15101', 'sac_code': '022', 'date': datetime.date(2025, 2, 23), 'cgst': 0.0, 'cgst_amount': 0.0, 'sgst': 0.0, 'sgst_amount': 0.0, 'igst': 0.0, 'igst_amount': 0.0, 'description': 'Tourism Tax', 'gst_rate': 0.0, 'item_taxable_value': 0.0, 'sac_code_found': 'Yes', 'is_credit_item': 'No', 'taxable': 'No', 'item_type': 'SAC', 'sort_order': 18039.0, 'cess': 0.0, 'cess_amount': 0.0, 'type': 'Included', 'item_mode': 'Credit', 'state_cess': 0.0, 'state_cess_amount': 0.0, 'vat': 0.0, 'vat_amount': 0.0, 'unit_of_measurement': 'OTH', 'unit_of_measurement_description': 'OTHERS', 'quantity': '1', 'sac_index': '057148', 'is_service_charge_item': 'No', 'is_manual_edit': 'No', 'discount_value': 0.0, 'line_edit_net': 'No', 'item_reference': '[NA Pkgs.TTX]', 'lut_exempted': 0, 'previous_lut_item': 0, 'check_number': None, 'reference_check_number': None, 'pos_check': None, 'revenue_item': 'Non-Revenue', 'non_gst_revenue': 0, 'subtype': 'B2B', 'sst': 0.0, 'sst_amount': 0.0, 'tourism_tax': 10.0, 'payment_credit_amount': 0.0, 'transaction_type': 'Is Tourism Tax Item', 'transaction_number': '9032207', 'trx_code_type': 'X', 'invoice_raised': 0, 'group_identifier': '144430-2', 'pos_credit_note_inv_number': None, 'pos_tax_inv_number': None, 'parent': '144430', 'parentfield': 'items', 'parenttype': 'Invoices', 'doctype': 'Items'}, {'name': 'e7cbkb2jk9', 'owner': 'ezyadmin@caratred.com', 'creation': Timestamp('2025-02-26 21:52:13.963432'), 'modified': Timestamp('2025-03-02 12:37:17.838581'), 'modified_by': 'Administrator', 'docstatus': 0, 'idx': 3, 'item_value': 200.0, 'item_value_after_gst': 200.0, 'item_name': 'Paid Out - Cash Deposit Refund', 'trx_code': '80104', 'sac_code': '022', 'date': datetime.date(2025, 2, 25), 'cgst': 0.0, 'cgst_amount': 0.0, 'sgst': 0.0, 'sgst_amount': 0.0, 'igst': 0.0, 'igst_amount': 0.0, 'description': 'Paid Out - Cash Deposit Refund', 'gst_rate': 0, 'item_taxable_value': 200.0, 'sac_code_found': 'Yes', 'is_credit_item': 'No', 'taxable': 'Yes', 'item_type': 'SAC', 'sort_order': 18036.0, 'cess': 0.0, 'cess_amount': 0.0, 'type': 'Excempted', 'item_mode': 'Credit', 'state_cess': 0.0, 'state_cess_amount': 0.0, 'vat': 0.0, 'vat_amount': 0.0, 'unit_of_measurement': 'OTH', 'unit_of_measurement_description': 'OTHERS', 'quantity': '1', 'sac_index': '843333', 'is_service_charge_item': 'No', 'is_manual_edit': 'No', 'discount_value': 0.0, 'line_edit_net': 'No', 'item_reference': 'Deposit Refund', 'lut_exempted': 0, 'previous_lut_item': 0, 'check_number': None, 'reference_check_number': None, 'pos_check': None, 'revenue_item': 'Revenue', 'non_gst_revenue': 0, 'subtype': 'B2B', 'sst': 0.0, 'sst_amount': 1, 'tourism_tax': 0.0, 'payment_credit_amount': 0.0, 'transaction_type': 'Is Regular Item', 'transaction_number': '9035424', 'trx_code_type': None, 'invoice_raised': 0, 'group_identifier': '144430-4', 'pos_credit_note_inv_number': None, 'pos_tax_inv_number': None, 'parent': '144430', 'parentfield': 'items', 'parenttype': 'Invoices', 'doctype': 'Items'}, {'name': 'e7cbm6vaoe', 'owner': 'ezyadmin@caratred.com', 'creation': Timestamp('2025-02-26 21:52:13.951963'), 'modified': Timestamp('2025-03-02 12:37:17.838581'), 'modified_by': 'Administrator', 'docstatus': 0, 'idx': 4, 'item_value': 0.0, 'item_value_after_gst': 5.0, 'item_name': 'Tourism Levy - Langkawi', 'trx_code': '15100', 'sac_code': '022', 'date': datetime.date(2025, 2, 23), 'cgst': 0.0, 'cgst_amount': 0.0, 'sgst': 0.0, 'sgst_amount': 0.0, 'igst': 0.0, 'igst_amount': 0.0, 'description': 'Tourism Levy - Langkawi', 'gst_rate': 0.0, 'item_taxable_value': 0.0, 'sac_code_found': 'Yes', 'is_credit_item': 'No', 'taxable': 'No', 'item_type': 'SAC', 'sort_order': 18038.0, 'cess': 0.0, 'cess_amount': 0.0, 'type': 'Included', 'item_mode': 'Credit', 'state_cess': 0.0, 'state_cess_amount': 0.0, 'vat': 0.0, 'vat_amount': 0.0, 'unit_of_measurement': 'OTH', 'unit_of_measurement_description': 'OTHERS', 'quantity': '0', 'sac_index': '702314', 'is_service_charge_item': 'No', 'is_manual_edit': 'No', 'discount_value': 0.0, 'line_edit_net': 'No', 'item_reference': '[Add: 5.]', 'lut_exempted': 0, 'previous_lut_item': 0, 'check_number': None, 'reference_check_number': None, 'pos_check': None, 'revenue_item': 'Non-Revenue', 'non_gst_revenue': 0, 'subtype': 'B2B', 'sst': 0.0, 'sst_amount': 0.0, 'tourism_tax': 5.0, 'payment_credit_amount': 0.0, 'transaction_type': 'Is Tourism Tax Item', 'transaction_number': '9032206', 'trx_code_type': 'X', 'invoice_raised': 0, 'group_identifier': '144430-2', 'pos_credit_note_inv_number': None, 'pos_tax_inv_number': None, 'parent': '144430', 'parentfield': 'items', 'parenttype': 'Invoices', 'doctype': 'Items'}, {'name': 'e7cbn3flu5', 'owner': 'ezyadmin@caratred.com', 'creation': Timestamp('2025-02-26 21:52:13.960676'), 'modified': Timestamp('2025-03-02 12:37:17.838581'), 'modified_by': 'Administrator', 'docstatus': 0, 'idx': 5, 'item_value': 0.0, 'item_value_after_gst': 10.0, 'item_name': 'Tourism Tax', 'trx_code': '15101', 'sac_code': '022', 'date': datetime.date(2025, 2, 24), 'cgst': 0.0, 'cgst_amount': 0.0, 'sgst': 0.0, 'sgst_amount': 0.0, 'igst': 0.0, 'igst_amount': 0.0, 'description': 'Tourism Tax', 'gst_rate': 0.0, 'item_taxable_value': 0.0, 'sac_code_found': 'Yes', 'is_credit_item': 'No', 'taxable': 'No', 'item_type': 'SAC', 'sort_order': 18032.0, 'cess': 0.0, 'cess_amount': 0.0, 'type': 'Included', 'item_mode': 'Credit', 'state_cess': 0.0, 'state_cess_amount': 0.0, 'vat': 0.0, 'vat_amount': 0.0, 'unit_of_measurement': 'OTH', 'unit_of_measurement_description': 'OTHERS', 'quantity': '1', 'sac_index': '057148', 'is_service_charge_item': 'No', 'is_manual_edit': 'No', 'discount_value': 0.0, 'line_edit_net': 'No', 'item_reference': '[NA Pkgs.TTX]', 'lut_exempted': 0, 'previous_lut_item': 0, 'check_number': None, 'reference_check_number': None, 'pos_check': None, 'revenue_item': 'Non-Revenue', 'non_gst_revenue': 0, 'subtype': 'B2B', 'sst': 0.0, 'sst_amount': 0.0, 'tourism_tax': 10.0, 'payment_credit_amount': 0.0, 'transaction_type': 'Is Tourism Tax Item', 'transaction_number': '9034909', 'trx_code_type': 'X', 'invoice_raised': 0, 'group_identifier': '144430-3', 'pos_credit_note_inv_number': None, 'pos_tax_inv_number': None, 'parent': '144430', 'parentfield': 'items', 'parenttype': 'Invoices', 'doctype': 'Items'}, {'name': 'e7cbrcjs3k', 'owner': 'ezyadmin@caratred.com', 'creation': Timestamp('2025-02-26 21:52:13.955161'), 'modified': Timestamp('2025-03-02 12:37:17.838581'), 'modified_by': 'Administrator', 'docstatus': 0, 'idx': 6, 'item_value': 0.0, 'item_value_after_gst': 5.0, 'item_name': 'Tourism Levy - Langkawi', 'trx_code': '15100', 'sac_code': '022', 'date': datetime.date(2025, 2, 24), 'cgst': 0.0, 'cgst_amount': 0.0, 'sgst': 0.0, 'sgst_amount': 0.0, 'igst': 0.0, 'igst_amount': 0.0, 'description': 'Tourism Levy - Langkawi', 'gst_rate': 0.0, 'item_taxable_value': 0.0, 'sac_code_found': 'Yes', 'is_credit_item': 'No', 'taxable': 'No', 'item_type': 'SAC', 'sort_order': 18031.0, 'cess': 0.0, 'cess_amount': 0.0, 'type': 'Included', 'item_mode': 'Credit', 'state_cess': 0.0, 'state_cess_amount': 0.0, 'vat': 0.0, 'vat_amount': 0.0, 'unit_of_measurement': 'OTH', 'unit_of_measurement_description': 'OTHERS', 'quantity': '0', 'sac_index': '702314', 'is_service_charge_item': 'No', 'is_manual_edit': 'No', 'discount_value': 0.0, 'line_edit_net': 'No', 'item_reference': '[Add: 5.]', 'lut_exempted': 0, 'previous_lut_item': 0, 'check_number': None, 'reference_check_number': None, 'pos_check': None, 'revenue_item': 'Non-Revenue', 'non_gst_revenue': 0, 'subtype': 'B2B', 'sst': 0.0, 'sst_amount': 0.0, 'tourism_tax': 5.0, 'payment_credit_amount': 0.0, 'transaction_type': 'Is Tourism Tax Item', 'transaction_number': '9034908', 'trx_code_type': 'X', 'invoice_raised': 0, 'group_identifier': '144430-3', 'pos_credit_note_inv_number': None, 'pos_tax_inv_number': None, 'parent': '144430', 'parentfield': 'items', 'parenttype': 'Invoices', 'doctype': 'Items'}]
items_df = pd.DataFrame.from_records(a)
items_df = items_df[['sac_code', 'gst_rate', 'description','transaction_type','revenue_item','quantity','taxable','item_value','sst_amount','tourism_tax','type']]
items_df["quantity"] = items_df["quantity"].fillna(1)
items_df["gst_rate"] = items_df["gst_rate"].astype(int)
items_df['sst_amount'] = items_df['sst_amount'].astype(float)
items_df.fillna("",inplace=True)
items_df = items_df.loc[~(items_df["transaction_type"] == "Is Payment Item")]
items_df = items_df.loc[~((items_df["transaction_type"].isin(["Is Regular Item", "Is Heritage Tax Item"])) & ((items_df["taxable"] == "No") | (items_df["revenue_item"] == "Non-Revenue")))]
invalid_rows = items_df[(items_df['type'] == 'Excempted') & (items_df['sst_amount'] != 0)]
if not invalid_rows.empty:
    raise ValueError("Tax amount should be zero for exempt records. Please verify if any records meet this condition.")
invalid_rows = items_df[(items_df['gst_rate'] != 0) & (items_df['sst_amount'] == 0)]
if not invalid_rows.empty:
    raise ValueError("Tax-amount must not be zero when the rate is greater than zero. Please verify if any records meet this condition.")

